---
title: "Regression Models Final Project"
author: "Ian Dobbs"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, fig.cap = TRUE, fig.align = "center",
                      fig.path="figures/", options(scipen=999))
knitr::opts_current$get('label')
```
```{r captioner, message=FALSE, echo=FALSE, results='hide'}
# use captioner to add figure number and caption
library(captioner)
fig_nums <- captioner()
fig_nums("figa", "A plot of mpg and transmission data where the red and blue horizontal lines represent the mean mpg for automatic and manual transmission respectively. The green line is the linear regression line")
```
## Executive Summary

This report for Motor Trend magazine will use the mtcars dataset to explore the relationship between 10 aspects of car design and performance (the variables), and fuel consumption measured in miles per US gallon, MPG (the outcome). The dataset contains data for 32 cars. In particular, the report will address the question of whether an automatic or manual transmission is better for fuel consumption and will quantify the difference in fuel consumption between automatic and manual transmission using regression models and exploratory data analyses.

## Summary of the data
```{r mtcars}
data(mtcars) # Load the data
str(mtcars) # and display the structure
```
Reveals a data frame with 32 observations on 11 (numeric) variables.

Outcome (dependent) Variable
[, 1]	mpg	Miles/(US) gallon

Predictor (independent) variables
[, 2]	cyl	Number of cylinders
[, 3]	disp	Displacement (cu.in.)
[, 4]	hp	Gross horsepower
[, 5]	drat	Rear axle ratio
[, 6]	wt	Weight (1000 lbs)
[, 7]	qsec	1/4 mile time
[, 8]	vs	Engine (0 = V-shaped, 1 = straight)
[, 9]	am	Transmission (0 = automatic, 1 = manual)
[,10]	gear	Number of forward gears
[,11]	carb	Number of carburetors

## Exploratory data analyses

```{r mpg, echo=FALSE, fig.cap=fig_nums("figa")}
manu <- subset(mtcars, am == "1")
auto <- subset(mtcars, am == "0")
plot(mtcars$am, mtcars$mpg, 
     main = "Fuel Consumption by Transmission",
     xlab = "Transmission (0 = automatic, 1 = manual)",
     ylab = "Miles/(US) gallon",
     col = ifelse(mtcars$am == "1", "blue", "red"))
legend("topleft", 
       pch = c(1, 1), 
       c("auto", "manu"), 
       col = c("red", "blue")) 
abline(lm(mtcars$mpg ~ mtcars$am), col = "green")
abline(h = mean(auto$mpg), col = "red")
abline(h = mean(manu$mpg), col = "blue")
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
## Simple Linear Regresssion
```{r lm, echo=FALSE}
summary(lm(mpg ~ factor(am), data = mtcars))$coefficients
summary(lm(mpg ~ factor(am), data = mtcars))$r.squared
```
## Residual Plot
```{r resid, echo=FALSE}
par(mfrow = c(2, 2))
fit <- lm(mpg ~ factor(am), data = mtcars)
plot(fit)
```

## Diagnostic - Correlation Matrix
```{r cor, echo=FALSE}
panel.cor <- function(x, y, digits = 2, prefix = "", cex.cor, ...) {
        usr <- par("usr")
        on.exit(par(usr))
        par(usr = c(0, 1, 0, 1))
        Cor <- cor(x, y) # add/Remove abs function if desired
        txt <- paste0(prefix, format(c(Cor, 0.123456789), digits = digits)[1])
        if(missing(cex.cor)) {
                cex.cor <- 0.4 / strwidth(txt)
        }
        text(0.5, 0.5, txt,
             cex = 1 + cex.cor * Cor) # Resize the text by level of correlation
}

# Plotting the correlation matrix
pairs(mtcars,
      upper.panel = panel.cor,    # Correlation panel
      lower.panel = panel.smooth,
      gap=0) # Smoothed regression lines
```

## Model Selection
```{r model, echo=FALSE}
fit1 <- lm(mpg ~ factor(am) + cyl + hp + wt, mtcars)
summary(fit1)$coef
summary(fit1)$r.squared
par(mfrow = c(2, 2))
plot(fit1)

```